<h1 style="font-size: 20px"><%= @subject %></h1>
<p>
  <strong><%= t('activity_report.mailer.total_hours') %>:</strong> <%= number_with_precision @total_hours, precision: 2, separator: '.' %>
  <strong><%= t('activity_report.mailer.total_issues_count') %>:</strong> <%= @total_issues_count %>
</p>

<table style="border-collapse: collapse">
  <thead>
    <tr>
      <th style="border: 1px solid #ddd; padding: 5px;"><%= t 'activity_report.mailer.user' %></th>
      <th style="border: 1px solid #ddd; padding: 5px;"><%= t 'activity_report.mailer.hours' %></th>
      <th style="border: 1px solid #ddd; padding: 5px;"><%= t 'activity_report.mailer.issues_count' %></th>
    </tr>
  </thead>
  <tbody>

    <% @time_entries.group_by(&:user).sort_by{|u, te| -te.map(&:hours).sum }.each do |user, time_entries| %>
      <tr>
        <td style="border: 1px solid #ddd; padding: 5px;"><%= user.name %></td>
        <td style="border: 1px solid #ddd; padding: 5px;"><%= number_with_precision time_entries.map(&:hours).sum, precision: 2, separator: '.' %></td>
        <td style="border: 1px solid #ddd; padding: 5px;"><%= time_entries.map(&:issue_id).uniq.size %></td>
      </tr>
    <% end %>
  </tbody>
</table>
<br/>
<% @time_entries.group_by(&:user).sort_by{|u, te| -te.map(&:hours).sum }.each do |user, time_entries| %>
  <h2 style="font-size: 18px"><%= user.name %></h2>
  <p>
    <strong><%= t('activity_report.mailer.total_hours') %>:</strong> <%= number_with_precision time_entries.map(&:hours).sum, precision: 2, separator: '.' %>
    <strong><%= t('activity_report.mailer.total_issues_count') %>:</strong> <%= time_entries.map(&:issue_id).uniq.size %>
  </p>
  <table style="border-collapse: collapse">
    <thead>
      <tr>
        <th style="border: 1px solid #ddd; padding: 5px;"><%= t 'activity_report.mailer.issue' %></th>
        <th style="border: 1px solid #ddd; padding: 5px;"><%= t 'activity_report.mailer.hours' %></th>
      </tr>
    </thead>
    <tbody>

      <% time_entries.group_by(&:issue).sort_by{|u, te| -te.map(&:hours).sum }.each do |issue, entries| %>
        <tr>
          <td style="border: 1px solid #ddd; padding: 5px;"><%= link_to "#{issue.id}: #{issue.subject}", issue_url(issue) %></td>
          <td style="border: 1px solid #ddd; padding: 5px;"><%= number_with_precision entries.map(&:hours).sum, precision: 2, separator: '.' %></td>
        </tr>
      <% end %>
    </tbody>
  </table>
<% end %>
